---
title: "InitialDataExploration"
author: "Kathleen Mason"
date: "10/6/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##In this Rmarkdown:
#Uploading data, plotting DO over time at each sampling site, Analysis Question 1
#Question 1: Are the DO means equivalent before and after dam removal?
#This includes taking a subset of DO data to ensure major outliers (-888mgL) are not changing statistical outcomes. Range was set to meet normal range of 0-15



```{r Setup and Upload}
library(tidyverse)
library(ggridges)

#install.packages('patchwork')
library(patchwork)


getwd()

mytheme <- theme_light(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top")
theme_set(mytheme)

Up1_processed<-read_csv("./Processed/Up1_processed.csv")
Up2_processed<-read_csv("./Processed/Up2_processed.csv")
Imp1_processed<-read_csv("./Processed/Imp1_processed.csv")
Imp2_processed<-read_csv("./Processed/Imp2_processed.csv")
Down1_processed<-read_csv("./Processed/Down1_processed.csv")
Down2A_processed<-read_csv("./Processed/Down2A_processed.csv")
Down2B_processed<-read_csv("./Processed/Down2B_processed.csv")

class(Up1_processed$Date)
```

```{r Initial Graphs}

#Rename the DO
colnames(Up1_processed)[4] <- "Dissolved Oxygen"
summary(Up1_processed$`Dissolved Oxygen`)
colnames(Imp1_processed)[5] <- "Dissolved Oxygen"
summary(Imp1_processed$`Dissolved Oxygen`)

colnames(Up2_processed)[4]<-"Dissolved Oxygen"
colnames(Imp2_processed)[6]<-"Dissolved Oxygen"

colnames(Down1_processed)[6]<-"Dissolved Oxygen"
colnames(Down2A_processed)[4]<-"Dissolved Oxygen"
colnames(Down2B_processed)[4]<-"Dissolved Oxygen"


#Average DO per day since sampled multiple times a day
Up1AvgDO<-  Up1_processed %>%
  group_by(Date) %>%
  summarise(AvgDO = mean(`Dissolved Oxygen`))
Imp1AvgDO<-  Imp1_processed %>%
  group_by(Date) %>%
  summarise(AvgDO = mean(`Dissolved Oxygen`))
Up2AvgDO<-  Up2_processed %>%
  group_by(Date) %>%
  summarise(AvgDO = mean(`Dissolved Oxygen`))
Imp2AvgDO<-  Imp2_processed %>%
  group_by(Date) %>%
  summarise(AvgDO = mean(`Dissolved Oxygen`))
Down1AvgDO<-  Down1_processed %>%
  group_by(Date) %>%
  summarise(AvgDO = mean(`Dissolved Oxygen`))
Down2AAvgDO<-  Down2A_processed %>%
  group_by(Date) %>%
  summarise(AvgDO = mean(`Dissolved Oxygen`))
Down2BAvgDO<-  Down2B_processed %>%
  group_by(Date) %>%
  summarise(AvgDO = mean(`Dissolved Oxygen`))
```


```{r}
write.csv(Up1AvgDO, file = "./Processed/Up1AvgDO_processed.csv", row.names=FALSE)
write.csv(Up2AvgDO, file = "./Processed/Up2AvgDO_processed.csv", row.names=FALSE)
write.csv(Imp1AvgDO, file = "./Processed/Imp1AvgDO_processed.csv", row.names=FALSE)
write.csv(Imp2AvgDO, file = "./Processed/Imp2AvgDO_processed.csv", row.names=FALSE)
write.csv(Down1AvgDO, file = "./Processed/Down1AvgDO_processed.csv", row.names=FALSE)
write.csv(Down2AAvgDO, file = "./Processed/Down2AAvgDO_processed.csv", row.names=FALSE)
write.csv(Down2BAvgDO, file = "./Processed/Down2BAvgDO_processed.csv", row.names=FALSE)
```

```{r}

#Graph
#creating line of dam removal date
d=data.frame(date=as.Date(c("2017-09-21")), event=c("Dam Removal"))

Up1plot <-ggplot(Up1AvgDO, aes(x = Date, y = AvgDO)) +
geom_point(size=.75, color="royalblue4")  + ylim(0, 15) +ylab("Avg Daily DO (mg/L)")+ xlab("Sampling Date")+scale_x_date(date_breaks = "1 year", date_minor_breaks= "months", date_labels = "%m/%y")+
  labs(title = "Upstream 1")+
  theme(panel.background = element_rect(fill = "grey97"),
        panel.grid.major = element_line(color = "gray68", size = 0.5),
        panel.grid.minor = element_line(color = "gray85", size = 0.25))+   
    geom_vline(data=d, mapping=aes(xintercept=date), color="red", lty=5, size=.5)


Up1plot


Imp1plot<- ggplot(Imp1AvgDO, aes(x = Date, y = AvgDO)) +
geom_point(size=.75, color="royalblue4")  +ylim(0, 15) +ylab("Avg Daily DO (mg/L)")+ xlab("Sampling Date")+scale_x_date(date_breaks = "1 year", date_minor_breaks= "months", date_labels = "%m/%y")+
  labs(title = "Impoundment 1")+
  theme(panel.background = element_rect(fill = "grey97"),
        panel.grid.major = element_line(color = "gray68", size = 0.5),
        panel.grid.minor = element_line(color = "gray85", size = 0.25))+                                
  geom_vline(data=d, mapping=aes(xintercept=date), color="red", lty=5, size=.5)

Imp1plot

Up2plot<- ggplot(Up2AvgDO, aes(x = Date, y = AvgDO)) +
geom_point(size=.75, color="royalblue4") +ylim(0, 15) +ylab("Avg Daily DO (mg/L)") + xlab("Sampling Date")+scale_x_date(date_breaks = "1 year", date_minor_breaks= "months", date_labels = "%m/%y")+
   labs(title = "Upstream 2")+
  theme(panel.background = element_rect(fill = "grey97"),
        panel.grid.major = element_line(color = "gray68", size = 0.5),
        panel.grid.minor = element_line(color = "gray85", size = 0.25))+                                
  geom_vline(data=d, mapping=aes(xintercept=date), color="red", lty=5, size=.5)


Up2plot

#No data for Imp2
Imp2plot<- ggplot(Imp2AvgDO, aes(x = Date, y = AvgDO)) +
geom_point(size=.75, color="royalblue4")+ylab("Avg Daily DO (mgL)")
summary(Up2_processed$`Dissolved Oxygen`) #No DO data actually exists for Imp2

Down1plot<- ggplot(Down1AvgDO, aes(x = Date, y = AvgDO)) +
geom_point(size=.75, color="royalblue4")+ ylim(0, 15)+ylab("Avg Daily DO (mg/L)")+ xlab("Sampling Date")+ scale_x_date(date_breaks = "1 year", date_minor_breaks= "months", date_labels = "%m/%y")+
   labs(title = "Downstream 1")+
  theme(panel.background = element_rect(fill = "grey97"),
        panel.grid.major = element_line(color = "gray68", size = 0.5),
        panel.grid.minor = element_line(color = "gray80", size = 0.25))+                                
  geom_vline(data=d, mapping=aes(xintercept=date), color="red", lty=5, size=.5)

summary(Down1AvgDO) #655 missing values

Down1plot

Down2Aplot<- ggplot(Down2AAvgDO, aes(x = Date, y = AvgDO)) +
geom_point(size=.75, color="royalblue4")+ylim(0, 15) +ylab("Avg Daily DO (mg/L)")+ xlab("Sampling Date")+scale_x_date(date_breaks = "1 year", date_minor_breaks= "months", date_labels = "%m/%y")+
   labs(title = "Downstream 2A")+
  theme(panel.background = element_rect(fill = "grey97"),
        panel.grid.major = element_line(color = "gray68", size = 0.5),
        panel.grid.minor = element_line(color = "gray80", size = 0.25))+                                
geom_vline(data=d, mapping=aes(xintercept=date), color="red", lty=5, size=.5)

Down2Aplot

Down2Bplot<- ggplot(Down2BAvgDO, aes(x = Date, y = AvgDO)) +
geom_point(size=.75, color="royalblue4")+ ylim(0,15)+ylab("Avg Daily DO (mg/L)")+ xlab("Sampling Date")+
  scale_x_date(date_breaks = "1 year", date_minor_breaks= "months", date_labels = "%m/%y") +
  labs(title = "Downstream 2B")+
  theme(panel.background = element_rect(fill = "grey97"),
        panel.grid.major = element_line(color = "gray68", size = 0.5),
        panel.grid.minor = element_line(color = "gray80", size = 0.25))+                                
 geom_vline(data=d, mapping=aes(xintercept=date), color="red", lty=5, size=.5)
Down2Bplot



AllUp<- Up1plot+Up2plot
AllUp


AllDown<-Down1plot+Down2Aplot+Down2Bplot

AllDown

Imp1plot


#Trying to add in line where dam was removed
#+abline(v=as.Date("2017-09-21","%Y-%m-%d"))
#+ abline(v=as.Date("2017-09-21"))
#+geom_text(y = as.Date("2020-01-01"), y = 120, label = "unhealthy (sensitive groups)", hjust = 1, fontface
#these are not working

summary(Down2BAvgDO)
```

```{r Saving plots}
ggsave("./Outputs/MilburnieDam_AllUpstreamSites_initial.jpg", plot=AllUp, width =10, height=6, units="in", dpi=300)
ggsave("./Outputs/MilburnieDam_ImpoundmentSites_initial.jpg", plot=Imp1plot, width =10, height=6, units="in", dpi=300)
ggsave("./Outputs/MilburnieDam_AllDownstreamSites_initial.jpg", plot=AllDown, width =15, height=6, units="in", dpi=300)
```


#Question 1: Are the DO means equivalent before and after dam removal?
```{r Setup for Statistical Analysis}
#Setting up the data in one dataset 
# Will then divide into two data sets by the removal date to have before and after categories and then run stat analysis
Up1AvgDOjoin<- Up1AvgDO %>% 
  mutate(Site = "Upstream1")

Up2AvgDOjoin<- Up2AvgDO %>% 
  mutate(Site = "Upstream2")

Down1AvgDOjoin<-Down1AvgDO%>% 
  mutate(Site = "Downstream1")

Down2AAvgDOjoin<-Down2AAvgDO%>% 
  mutate(Site = "Downstream2A")

Down2BAvgDOjoin<-Down2BAvgDO%>% 
  mutate(Site = "Downstream2B")

Imp1AvgDOjoin<-Imp1AvgDO%>% 
  mutate(Site = "Impoundment1")


#merging all data frames vertically
MilburnieDam_AllSitesDO <- rbind(Up1AvgDOjoin, Up2AvgDOjoin, Down1AvgDOjoin, Down2AAvgDOjoin, Down2BAvgDOjoin, Imp1AvgDOjoin)



#Dividing the data set in two: before and after. The date for removal of the dam will be used as dividing factor
MilburnieDam_AllSitesDO_Before <- MilburnieDam_AllSitesDO %>% filter(Date < as.Date("2017-09-21"))

MilburnieDam_AllSitesDO_After <- MilburnieDam_AllSitesDO %>% filter(Date > as.Date("2017-09-21"))


MilburnieDam_AllSitesDO_After$TimeStamp<-"After"
MilburnieDam_AllSitesDO_Before$TimeStamp<-"Before"

MilburnieDam_AllSitesDO_TimeStamp<- full_join(MilburnieDam_AllSitesDO_After, MilburnieDam_AllSitesDO_Before)


#Save these datasets
write.csv(MilburnieDam_AllSitesDO, row.names = FALSE, file =("./Processed/MilburnieDam_AllSitesDO_processed.csv"))
write.csv(MilburnieDam_AllSitesDO_Before, row.names = FALSE, file =("./Processed/MilburnieDam_AllSitesDO_Before_processed.csv"))
write.csv(MilburnieDam_AllSitesDO_After, row.names = FALSE, file =("./Processed/MilburnieDam_AllSitesDO_After_processed.csv"))
write.csv(MilburnieDam_AllSitesDO_TimeStamp, row.names = FALSE, file =("./Processed/MilburnieDam_AllSitesDO_TimeStamp_processed.csv"))

#Time for Statistical analysis...

```

```{r Statistical Test to Question 1}

shapiro.test(MilburnieDam_AllSitesDO_TimeStamp$AvgDO[MilburnieDam_AllSitesDO_TimeStamp$TimeStamp == "After"])
#Results: W = 0.95863, p-value < 2.2e-16

shapiro.test(MilburnieDam_AllSitesDO_TimeStamp$AvgDO[MilburnieDam_AllSitesDO_TimeStamp$TimeStamp == "Before"])
#Results: W = 0.043862, p-value < 2.2e-16


var.test(MilburnieDam_AllSitesDO_TimeStamp$AvgDO ~ MilburnieDam_AllSitesDO_TimeStamp$TimeStamp)
#Results
#F = 0.0069476, num df = 1888, denom df = 2767, p-value < 2.2e-16
#alternative hypothesis: true ratio of variances is not equal to 1
#95 percent confidence interval:
 #0.006397852 0.007549537
#sample estimates:
#ratio of variances 
 #      0.006947602 


vartest<-ggplot(MilburnieDam_AllSitesDO_TimeStamp, aes(x = AvgDO, color = TimeStamp)) + geom_freqpoly()
vartest

 AvgDO.twosample <- t.test(MilburnieDam_AllSitesDO_TimeStamp$AvgDO ~ MilburnieDam_AllSitesDO_TimeStamp$TimeStamp) 
AvgDO.twosample
#Results:
#t = 0.46225, df = 2823.2, p-value = 0.6439
#alternative hypothesis: true difference in means is not equal to 0
#95 percent confidence interval:
 #-0.9804282  1.5852870
#sample estimates:
 #mean in group After mean in group Before 
     #       7.896364             7.593935 

AvgDO.twosample$p.value
#0.6439354

#Format as GLM
AvgDO.twosample2 <- lm(MilburnieDam_AllSitesDO_TimeStamp$AvgDO ~ MilburnieDam_AllSitesDO_TimeStamp$TimeStamp) 
summary(AvgDO.twosample2)
plot(AvgDO.twosample2)


#Normality is not met Pvalue <0.05

#Wilcoxon Test
AvgDO.twosample.wilcox <- wilcox.test(MilburnieDam_AllSitesDO_TimeStamp$AvgDO ~ MilburnieDam_AllSitesDO_TimeStamp$TimeStamp) 

AvgDO.twosample.wilcox
#Results
#W = 2057288, p-value < 2.2e-16
#alternative hypothesis: true location shift is not equal to 0

#Interpretation.... significant difference in Avg daily DO during and after the dam removal(p value<0.0001, Wilcoxon test, W= 2057288)


#Graph this!!
MilburnieDam_AvgDO_Q1boxplot_1<-ggplot(MilburnieDam_AllSitesDO_TimeStamp) +
geom_boxplot(aes(x = TimeStamp, y = AvgDO), color="skyblue4", alpha=0.75)+
  xlab("Timeframe in the Dam \nRemoval Process")+
  ylab("Average Dissolved \nOxygen (mgL)")+
  mytheme
MilburnieDam_AvgDO_Q1boxplot_1

MilburnieDam_AvgDO_Q1boxplot<-ggplot(MilburnieDam_AllSitesDO_TimeStamp) +
geom_boxplot(aes(x = TimeStamp, y = AvgDO), color="skyblue4", alpha=0.75)+
  xlab("Timeframe in the Dam \nRemoval Process")+
  ylab("Average Dissolved \nOxygen (mgL)")+
  mytheme+
  ylim(0,15)
MilburnieDam_AvgDO_Q1boxplot
  
ggsave("./Outputs/MilburnieDam_AvgDO_Q1boxplot.jpg", plot=MilburnieDam_AvgDO_Q1boxplot, width =10, height=6, units="in", dpi=300)
ggsave("./Outputs/MilburnieDam_AvgDO_Q1boxplot_1.jpg", plot=MilburnieDam_AvgDO_Q1boxplot_1, width =10, height=6, units="in", dpi=300)

#summary stats
tapply(MilburnieDam_AllSitesDO_TimeStamp$AvgDO, MilburnieDam_AllSitesDO_TimeStamp$TimeStamp, summary)
#$After
 #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
# -0.010   6.280   7.864   7.896  10.145  14.039     630 

#$Before
#    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's 
#-888.880    6.950    8.860    7.594   11.303   14.411      317 


#***There are a lot of outliers in the Before DO dataset, these include values as low as -888!!!
#I should eliminate values below 0 and rerun the test.
```



```{r Statistical Analysis for Question 1 Eliminating Outliers}
#Use Timestamp dataset as the latest
#Take subsets of values of DO in order to rid of negative values. 
#Subset to use will be 0-15, this takes into account the max value and normal range of values

MilburnieDam_AllSitesDO_TimeStampSUBSET <- subset(MilburnieDam_AllSitesDO_TimeStamp, AvgDO >= 0 & AvgDO  <= 15, 
select=c(Date:TimeStamp))
summary(MilburnieDam_AllSitesDO_TimeStampSUBSET)

MilburnieDam_AllSitesDO_BeforeSUBSET <- subset(MilburnieDam_AllSitesDO_Before, AvgDO >= 0 & AvgDO  <= 15, 
select=c(Date:TimeStamp))
summary(MilburnieDam_AllSitesDO_BeforeSUBSET)

MilburnieDam_AllSitesDO_AfterSUBSET <- subset(MilburnieDam_AllSitesDO_After, AvgDO >= 0 & AvgDO  <= 15, 
select=c(Date:TimeStamp))
summary(MilburnieDam_AllSitesDO_AfterSUBSET)

write.csv(MilburnieDam_AllSitesDO_TimeStampSUBSET, row.names = FALSE, file =("./Processed/MilburnieDam_AllSitesDO_TimeStampSUBSET_processed.csv"))
write.csv(MilburnieDam_AllSitesDO_BeforeSUBSET, row.names = FALSE, file =("./Processed/MilburnieDam_AllSitesDO_BeforeSUBSET_processed.csv"))
write.csv(MilburnieDam_AllSitesDO_AfterSUBSET, row.names = FALSE, file =("./Processed/MilburnieDam_AllSitesDO_AfterSUBSET_processed.csv"))




shapiro.test(MilburnieDam_AllSitesDO_TimeStampSUBSET$AvgDO[MilburnieDam_AllSitesDO_TimeStampSUBSET$TimeStamp == "After"])
#Results: W = 0.96342, p-value < 2.2e-16

shapiro.test(MilburnieDam_AllSitesDO_TimeStampSUBSET$AvgDO[MilburnieDam_AllSitesDO_TimeStampSUBSET$TimeStamp == "Before"])
#Results:  W = 0.96242, p-value < 2.2e-16


var.test(MilburnieDam_AllSitesDO_TimeStampSUBSET$AvgDO ~ MilburnieDam_AllSitesDO_TimeStampSUBSET$TimeStamp)
#Results
#F = 1.1581, num df = 1874, denom df = 2678, p-value = 0.0005348
#alternative hypothesis: true ratio of variances is not equal to 1
#95 percent confidence interval:
# 1.065699 1.259395
#sample estimates:
#ratio of variances 
 #         1.158145 


vartest_SUBSET<-ggplot(MilburnieDam_AllSitesDO_TimeStampSUBSET, aes(x = AvgDO, color = TimeStamp)) + geom_freqpoly()
vartest

 AvgDO_SUBSET.twosample <- t.test(MilburnieDam_AllSitesDO_TimeStampSUBSET$AvgDO ~ MilburnieDam_AllSitesDO_TimeStampSUBSET$TimeStamp) 
AvgDO_SUBSET.twosample
#Results:
#t = -15.13, df = 3841.6, p-value < 2.2e-16
#alternative hypothesis: true difference in means is not equal to 0
#95 percent confidence interval:
# -1.390786 -1.071697
#sample estimates:
 #mean in group After mean in group Before 
  #          7.955386             9.186628 

AvgDO_SUBSET.twosample$p.value
#2.799219e-50

#Format as GLM
AvgDO_SUBSET.twosample2 <- lm(MilburnieDam_AllSitesDO_TimeStampSUBSET$AvgDO ~ MilburnieDam_AllSitesDO_TimeStampSUBSET$TimeStamp) 
summary(AvgDO_SUBSET.twosample2)
plot(AvgDO_SUBSET.twosample2)


#Normality is not met Pvalue <0.05


#Wilcoxon Test
AvgDO_SUBSET.twosample.wilcox <- wilcox.test(MilburnieDam_AllSitesDO_TimeStampSUBSET$AvgDO ~ MilburnieDam_AllSitesDO_TimeStampSUBSET$TimeStamp) 

AvgDO_SUBSET.twosample.wilcox
#Results
#W = 1889176, p-value < 2.2e-16
#alternative hypothesis: true location shift is not equal to 0

#Interpretation.... significant difference in Avg daily DO during and after the dam removal(p value<0.0001, Wilcoxon test, W=  1889176)

#Graph this!
MilburnieDam_AvgDO_SUBSET_Q1boxplot<-ggplot(MilburnieDam_AllSitesDO_TimeStampSUBSET) +
geom_boxplot(aes(x = TimeStamp, y = AvgDO), color="skyblue4", alpha=0.75)+
  xlab("Timeframe in the Dam \nRemoval Process")+
  ylab("Average Dissolved \nOxygen (mgL)")+
  mytheme
#+ylim(0,15)
MilburnieDam_AvgDO_SUBSET_Q1boxplot
  
ggsave("./Outputs/MilburnieDam_AvgDO_Q1boxplot_subset.jpg", plot=MilburnieDam_AvgDO_Q1boxplot, width =10, height=6, units="in", dpi=300)

#summary stats
tapply(MilburnieDam_AllSitesDO_TimeStampSUBSET$AvgDO, MilburnieDam_AllSitesDO_TimeStampSUBSET$TimeStamp, summary)

#Same results but with a different magnitude
#Same interpretation
```

```{r Dividing Q1 into sites}
# use MilburnieDam_AllSitesDO_TimeStampSUBSET and divide into the different sites


targetup1 <- c("Upstream1", "Upstream2")
MilburnieDam_Upstream_Q1 <- filter(MilburnieDam_AllSitesDO_TimeStampSUBSET, Site %in% targetup1)
MilburnieDam_Upstream_Q1$Location<-"Upstream"

write.csv(MilburnieDam_Upstream_Q1 , row.names = FALSE, file =("./Processed/MilburnieDam_Upstream_Q1 _processed.csv"))


targetimp1 <- c("Impoundment1", "Impoundment2")
MilburnieDam_Impoundment_Q1 <- filter(MilburnieDam_AllSitesDO_TimeStampSUBSET, Site %in% targetimp1)
MilburnieDam_Impoundment_Q1$Location<-"Impoundment"

write.csv(MilburnieDam_Impoundment_Q1 , row.names = FALSE, file =("./Processed/MilburnieDam_Impoundment_Q1 _processed.csv"))


targetdown1 <- c("Downstream1", "Downstream2A", "Downstream2B")
MilburnieDam_Downstream_Q1 <- filter(MilburnieDam_AllSitesDO_TimeStampSUBSET, Site %in% targetdown1)
MilburnieDam_Downstream_Q1$Location<-"Downstream"

write.csv(MilburnieDam_Downstream_Q1 , row.names = FALSE, file =("./Processed/MilburnieDam_Downstream_Q1 _processed.csv"))

##Now compare before and after dam removal for each site location...

```

```{r Upstream Sites}

shapiro.test(MilburnieDam_Upstream_Q1$AvgDO[MilburnieDam_Upstream_Q1$TimeStamp == "After"])
#Results: W = 0.94248, p-value = 3.702e-15

shapiro.test(MilburnieDam_Upstream_Q1$AvgDO[MilburnieDam_Upstream_Q1$TimeStamp == "Before"])
#Results:  W = 0.94276, p-value < 2.2e-16


var.test(MilburnieDam_Upstream_Q1$AvgDO ~ MilburnieDam_Upstream_Q1$TimeStamp)
#Results F = 1.146, num df = 648, denom df = 948, p-value = 0.05715
#alternative hypothesis: true ratio of variances is not equal to 1
#95 percent confidence interval:
# 0.9958734 1.3213372
#sample estimates:
#ratio of variances 
    #      1.146028 

vartest_Up1<-ggplot(MilburnieDam_Upstream_Q1, aes(x = AvgDO, color = TimeStamp)) + geom_freqpoly()
vartest_Up1

 AvgDO_Q1_Up.twosample <- t.test(MilburnieDam_Upstream_Q1$AvgDO ~ MilburnieDam_Upstream_Q1$TimeStamp) 
AvgDO_Q1_Up.twosample
#Results:
#t = -8.086, df = 1328.7, p-value = 1.376e-15
#alternative hypothesis: true difference in means is not equal to 0
#95 percent confidence interval:
 #-1.3694891 -0.8347233
#sample estimates:
# mean in group After mean in group Before 
  #          8.250958             9.353064 

AvgDO_Q1_Up.twosample$p.value
# 1.375969e-15

#Format as GLM
AvgDO_Q1_Up.twosample2 <- lm(MilburnieDam_Upstream_Q1$AvgDO ~ MilburnieDam_Upstream_Q1$TimeStamp) 
summary(AvgDO_Q1_Up.twosample2)
plot(AvgDO_Q1_Up.twosample2)


#Normality is not met Pvalue <0.05

#Wilcoxon Test
AvgDO_Q1_Up.twosample.wilcox <- wilcox.test(MilburnieDam_Upstream_Q1$AvgDO ~ MilburnieDam_Upstream_Q1$TimeStamp) 

AvgDO_Q1_Up.twosample.wilcox
#Results
#W = 246658, p-value = 1.326e-11
#alternative hypothesis: true location shift is not equal to 0

#Interpretation.... significant difference in Avg daily DO during and after the dam removal(p value<0.0001, Wilcoxon test, W=  246658)

#Graph this!
MilburnieDam_AvgDO_Q1_Up_boxplot<-ggplot(MilburnieDam_Upstream_Q1) +
geom_boxplot(aes(x = TimeStamp, y = AvgDO), color="skyblue4", alpha=0.75)+
  xlab("Timeframe in the Dam \nRemoval Process")+
  ylab("Average Dissolved \nOxygen (mgL)")+
  mytheme+
  ggtitle("Upstream Sites")
#+ylim(0,15)
MilburnieDam_AvgDO_Q1_Up_boxplot
  
ggsave("./Outputs/MilburnieDam_AvgDO_Q1_Up_boxplot.jpg", plot=MilburnieDam_AvgDO_Q1_Up_boxplot, width =10, height=6, units="in", dpi=300)

#summary stats
tapply(MilburnieDam_Upstream_Q1$AvgDO, MilburnieDam_Upstream_Q1$TimeStamp, summary)
#$After
  # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  #0.000   6.539   8.128   8.251  10.484  13.276 

#$Before
  # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
# 0.0483  6.9214  9.2257  9.3531 11.5272 14.3766 

```

```{r Impoundment Sites}
shapiro.test(MilburnieDam_Impoundment_Q1$AvgDO[MilburnieDam_Impoundment_Q1$TimeStamp == "After"])
#Results: W = 0.94117, p-value = 6.558e-10

shapiro.test(MilburnieDam_Impoundment_Q1$AvgDO[MilburnieDam_Impoundment_Q1$TimeStamp == "Before"])
#Results:  W = 0.96531, p-value = 6.079e-08


var.test(MilburnieDam_Impoundment_Q1$AvgDO ~ MilburnieDam_Impoundment_Q1$TimeStamp)
#Results F = 0.77383, num df = 316, denom df = 386, p-value = 0.01772
#alternative hypothesis: true ratio of variances is not equal to 1
#95 percent confidence interval:
# 0.6275617 0.9563216
#sample estimates:
#ratio of variances 
  #       0.7738264 

vartest_Imp1<-ggplot(MilburnieDam_Impoundment_Q1, aes(x = AvgDO, color = TimeStamp)) + geom_freqpoly()
vartest_Imp1

 AvgDO_Q1_Imp.twosample <- t.test(MilburnieDam_Impoundment_Q1$AvgDO ~ MilburnieDam_Impoundment_Q1$TimeStamp) 
AvgDO_Q1_Imp.twosample
#Results:
#t = -2.3727, df = 698.42, p-value = 0.01793
#alternative hypothesis: true difference in means is not equal to 0
#95 percent confidence interval:
# -0.96130475 -0.09075482
#sample estimates:
# mean in group After mean in group Before 
 #           7.983866             8.509896 

AvgDO_Q1_Imp.twosample$p.value
# 0.01792709

#Format as GLM
AvgDO_Q1_Imp.twosample2 <- lm(MilburnieDam_Impoundment_Q1$AvgDO ~ MilburnieDam_Impoundment_Q1$TimeStamp) 
summary(AvgDO_Q1_Imp.twosample2)
plot(AvgDO_Q1_Imp.twosample2)


#Normality is  met Pvalue >0.05

#Wilcoxon Test
AvgDO_Q1_Imp.twosample.wilcox <- wilcox.test(MilburnieDam_Impoundment_Q1$AvgDO ~ MilburnieDam_Impoundment_Q1$TimeStamp) 

AvgDO_Q1_Imp.twosample.wilcox
#Results
#W = 55191, p-value = 0.02202
#alternative hypothesis: true location shift is not equal to 0

#Interpretation.... no significant difference in Avg daily DO during and after the dam removal(p value>0.0001, Wilcoxon test, W = 55191)

#Graph this!
MilburnieDam_AvgDO_Q1_Imp_boxplot<-ggplot(MilburnieDam_Impoundment_Q1) +
geom_boxplot(aes(x = TimeStamp, y = AvgDO), color="skyblue4", alpha=0.75)+
  xlab("Timeframe in the Dam \nRemoval Process")+
  ylab("Average Dissolved \nOxygen (mgL)")+
  mytheme+
  ggtitle("Impoundment Sites")
#+ylim(0,15)
MilburnieDam_AvgDO_Q1_Imp_boxplot
  
ggsave("./Outputs/MilburnieDam_AvgDO_Q1_Imp_boxplot.jpg", plot=MilburnieDam_AvgDO_Q1_Imp_boxplot, width =10, height=6, units="in", dpi=300)

#summary stats
tapply(MilburnieDam_Impoundment_Q1$AvgDO, MilburnieDam_Impoundment_Q1$TimeStamp, summary)
#$After
  # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  #0.02813  6.39434  7.50417  7.98387 10.08809 13.15788 


#$Before
  # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
# 0.0659  6.3631  8.4339  8.5099 11.1135 14.2419 
```

```{r Downstream Sites}
shapiro.test(MilburnieDam_Downstream_Q1$AvgDO[MilburnieDam_Downstream_Q1$TimeStamp == "After"])
#Results:W = 0.97528, p-value = 2.667e-11

shapiro.test(MilburnieDam_Downstream_Q1$AvgDO[MilburnieDam_Downstream_Q1$TimeStamp == "Before"])
#Results:  W = 0.96158, p-value < 2.2e-16


var.test(MilburnieDam_Downstream_Q1$AvgDO ~ MilburnieDam_Downstream_Q1$TimeStamp)
#Results F = 1.3728, num df = 908, denom df = 1342, p-value = 1.443e-07
#alternative hypothesis: true ratio of variances is not equal to 1
#95 percent confidence interval
# 1.219433 1.547635
#sample estimates:
#ratio of variances 
 #         1.372814  

vartest_Down1<-ggplot(MilburnieDam_Downstream_Q1, aes(x = AvgDO, color = TimeStamp)) + geom_freqpoly()
vartest_Down1

 AvgDO_Q1_Down.twosample <- t.test(MilburnieDam_Downstream_Q1$AvgDO ~ MilburnieDam_Downstream_Q1$TimeStamp) 
AvgDO_Q1_Down.twosample
#Results:
#t = -13.48, df = 1738.2, p-value < 2.2e-16
#alternative hypothesis: true difference in means is not equal to 0
#95 percent confidence interval:
# -1.752151 -1.307054
#sample estimates:
# mean in group After mean in group Before 
 #           7.734424             9.264027 

AvgDO_Q1_Down.twosample$p.value
# 1.820982e-39

#Format as GLM
AvgDO_Q1_Down.twosample2 <- lm(MilburnieDam_Downstream_Q1$AvgDO ~ MilburnieDam_Downstream_Q1$TimeStamp) 
summary(AvgDO_Q1_Down.twosample2)
plot(AvgDO_Q1_Down.twosample2)


#Normality is  not met Pvalue <0.05

#Wilcoxon Test
AvgDO_Q1_Down.twosample.wilcox <- wilcox.test(MilburnieDam_Downstream_Q1$AvgDO ~ MilburnieDam_Downstream_Q1$TimeStamp) 

AvgDO_Q1_Down.twosample.wilcox
#Results
#W = 414772, p-value < 2.2e-16
#alternative hypothesis: true location shift is not equal to 0

#Interpretation.... significant difference in Avg daily DO during and after the dam removal(p value<0.0001, Wilcoxon test, W = 414772)

#Graph this!
MilburnieDam_AvgDO_Q1_Down_boxplot<-ggplot(MilburnieDam_Downstream_Q1) +
geom_boxplot(aes(x = TimeStamp, y = AvgDO), color="skyblue4", alpha=0.75)+
  xlab("Timeframe in the Dam \nRemoval Process")+
  ylab("Average Dissolved \nOxygen (mgL)")+
  mytheme+
  ggtitle("Downstream Sites")
#+ylim(0,15)
MilburnieDam_AvgDO_Q1_Down_boxplot
  
ggsave("./Outputs/MilburnieDam_AvgDO_Q1_Down_boxplot.jpg", plot=MilburnieDam_AvgDO_Q1_Down_boxplot, width =10, height=6, units="in", dpi=300)

#summary stats
tapply(MilburnieDam_Downstream_Q1$AvgDO, MilburnieDam_Downstream_Q1$TimeStamp, summary)
#$After
  # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  #0.01698  6.02913  7.63122  7.73442 10.04740 14.03910 


#$Before
  # Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#  0.01115  7.31493  9.12813  9.26403 11.30389 14.41063 
```

